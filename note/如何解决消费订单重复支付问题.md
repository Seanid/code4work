消费订单重复支付的场景，通常出现在收银台支持多种支付方式的情况下，常见如a订单通过微信扫码支付成功后又通过支付宝扫码成功了，支付成功的回调先后到达，但订单只有一条，因此导致重复收款。

## 解决方案
1. 前端做好重复提交控制，如果是自定义的收银台，扫码后可能进入的是自开发的H5页面，可以在这个阶段，增加一个扫码的订单状态，通过这个状态控制页面上二维码的显示，达到反复提交的控制
2. 处理好状态机的流程控制，保证每个状态都是不可重复修改的，避免重复支付的情况下的校验控制异常。即如果状态为支付成功，订单就不应该能够再进行支付成功的状态更新了
3. 如果自定义了交易中心，可以增加支付信息校验回调，校验支付信息是否合规，合规才允许支付调起
4. 做好冲正操作，有了状态机的控制，重复订单支付成功回调的信息会报异常，异常捕获后，需要根据情况做好冲正处理
5. 通过对账机制，实现冲正操作
6. 目前有些场景，页面上是同时显示支付宝和微信两种付款码的。这种情况，如果使用同一个订单号去生成第三方支付订单的话，在回调的时候可能无法定位交易渠道或者误以为是第三方的重试操作。这种情况可以在生成支付订单号的时候，为两种支付方式都生成订单号，订单号中包含支付平台信息，在回调的时候根据平台和订单号定位并排查控制